<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VideoHub - Watch & Enjoy</title>
<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; background: #121212; color: #eee; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  header {
    background: #1f1f1f; padding: 15px 20px; font-size: 1.8rem; font-weight: bold; text-align: center; border-bottom: 3px solid #ff3c00;
  }
  .container {
    display: flex; height: calc(100vh - 70px);
  }
  nav.sidebar {
    width: 280px; background: #222; display: flex; flex-direction: column; padding: 20px; gap: 15px;
  }
  nav.sidebar h2 {
    font-size: 1.4rem; color: #ff3c00; user-select: none; margin-bottom: 10px;
  }
  nav.sidebar button.tab-btn {
    background: #333; border: none; border-radius: 6px; color: #ccc; padding: 12px 10px; cursor: pointer; font-weight: 600; text-align: left; transition: background-color 0.3s ease;
  }
  nav.sidebar button.tab-btn.active,
  nav.sidebar button.tab-btn:hover {
    background: #ff3c00; color: #121212; font-weight: bold;
  }
  nav.sidebar .search-section {
    margin-top: 20px;
  }
  nav.sidebar label {
    display: block; margin-bottom: 6px; font-size: 1rem;
  }
  nav.sidebar input[type="search"],
  nav.sidebar input[type="url"] {
    padding: 8px; border-radius: 6px; border: none; font-size: 1rem; width: 100%; background: #333; color: #eee;
  }
  nav.sidebar form {
    margin-top: 15px;
  }
  nav.sidebar button.upload-btn {
    margin-top: 10px; background: #ff3c00; border: none; padding: 10px; border-radius: 6px; color: #121212; font-weight: bold; cursor: pointer; width: 100%; transition: background-color 0.3s ease;
  }
  nav.sidebar button.upload-btn:hover {
    background: #ff6a33;
  }
  main.content {
    flex-grow: 1; padding: 20px; overflow-y: auto; background: #181818; display: flex; flex-direction: column;
  }
  .videos-grid {
    display: grid; grid-template-columns: repeat(auto-fill,minmax(320px,1fr)); gap: 20px;
  }
  .video-card {
    background: #272727; border-radius: 10px; padding: 10px; box-shadow: 0 0 8px #ff3c00cc; display: flex; flex-direction: column; user-select: none;
  }
  .video-thumb iframe {
    border-radius: 8px; width: 100%; height: 180px;
  }
  .video-info {
    margin-top: 10px; display: flex; justify-content: space-between; align-items: center;
  }
  .video-title {
    font-weight: 600; font-size: 1rem; flex-grow: 1; margin-right: 10px; color: #fff;
  }
  .video-actions button {
    background: #333; border: none; border-radius: 6px; color: #ccc; padding: 6px 12px; cursor: pointer; font-weight: 600; margin-left: 6px; transition: background-color 0.3s ease, color 0.3s ease;
  }
  .video-actions button:hover {
    background: #ff3c00; color: #121212;
  }
  .video-actions button.liked {
    background: #ff3c00; color: #121212;
  }
  .video-actions button.favorited {
    background: gold; color: #121212;
  }
  main.content::-webkit-scrollbar {
    width: 10px;
  }
  main.content::-webkit-scrollbar-track {
    background: #222;
  }
  main.content::-webkit-scrollbar-thumb {
    background-color: #ff3c00; border-radius: 10px;
  }
  @media (max-width: 768px) {
    .container {
      flex-direction: column;
    }
    nav.sidebar {
      width: 100%; flex-direction: row; overflow-x: auto; padding: 10px; gap: 10px;
    }
    nav.sidebar > * {
      margin-right: 20px; flex-shrink: 0;
    }
    main.content {
      height: auto;
    }
    .videos-grid {
      grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    }
  }
</style>
</head>
<body>
<header>VideoHub ðŸŽ¥</header>
<div class="container">
  <nav class="sidebar">
    <h2>Categories</h2>
    <button class="tab-btn active" data-tab="all">All</button>
    <button class="tab-btn" data-tab="uploads">Uploads</button>
    <button class="tab-btn" data-tab="favorites">Favorites</button>
    <button class="tab-btn" data-tab="extras">Extras</button>

    <div class="search-section">
      <label for="searchInput">Search Videos</label>
      <input type="search" id="searchInput" placeholder="Type to search..." autocomplete="off" />
    </div>

    <form id="uploadForm" title="Add a YouTube Video by Link">
      <label for="videoUrl">Add Video (YouTube URL):</label>
      <input type="url" id="videoUrl" placeholder="https://www.youtube.com/watch?v=VIDEO_ID" required pattern="https?://(www\.)?youtube\.com/watch\?v=[\w-]{11}" />
      <button type="submit" class="upload-btn">Add Video</button>
    </form>
  </nav>

  <main class="content">
    <div class="videos-grid" id="videosGrid"></div>
    <div class="pagination" id="pagination" style="margin-top: 20px; display:flex; justify-content:center; gap:8px; user-select:none;"></div>
  </main>
</div>

<script>
  const videosGrid = document.getElementById('videosGrid');
  const pagination = document.getElementById('pagination');
  const tabs = document.querySelectorAll('nav.sidebar button.tab-btn');
  const searchInput = document.getElementById('searchInput');
  const uploadForm = document.getElementById('uploadForm');
  const videoUrlInput = document.getElementById('videoUrl');

  const VIDEOS_PER_PAGE = 8;
  let currentPage = 1;
  let currentTab = 'all';
  let searchTerm = '';

  // Default videos with IDs only
  const defaultVideos = [
    { id: "dQw4w9WgXcQ" },
    { id: "noLL5xy0UnU" },
    { id: "6zp3mt5Dd2c" },
    { id: "MsXdUtlDVhk" },
    { id: "tAGnKpE4NCI" },
    { id: "3JZ_D3ELwOQ" },
    { id: "Zi_XLOBDo_Y" },
    { id: "V-_O7nl0Ii0" }
  ];

  // LocalStorage helpers
  function loadUserVideos() {
    return JSON.parse(localStorage.getItem('userVideos') || '[]');
  }
  function saveUserVideos(videos) {
    localStorage.setItem('userVideos', JSON.stringify(videos));
  }
  let userVideos = loadUserVideos();

  function loadFavorites() {
    return JSON.parse(localStorage.getItem('favorites') || '[]');
  }
  function saveFavorites() {
    localStorage.setItem('favorites', JSON.stringify(favorites));
  }
  let favorites = loadFavorites();

  function loadLikes() {
    return JSON.parse(localStorage.getItem('likes') || '{}');
  }
  function saveLikes() {
    localStorage.setItem('likes', JSON.stringify(likes));
  }
  let likes = loadLikes();

  // Fetch title from YouTube oEmbed API
  async function fetchTitle(videoId) {
    try {
      const res = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
      if (!res.ok) throw new Error('Video not found');
      const data = await res.json();
      return data.title;
    } catch {
      return "Unknown Title";
    }
  }

  // Cache for titles
  const titleCache = {};

  async function fetchTitles(videos) {
    const promises = videos.map(async v => {
      if (!titleCache[v.id]) {
        titleCache[v.id] = await fetchTitle(v.id);
      }
      return { id: v.id, title: titleCache[v.id], category: v.category || 'uploads' };
    });
    return Promise.all(promises);
  }

  async function renderVideos(page = 1) {
    userVideos = loadUserVideos();
    favorites = loadFavorites();
    likes = loadLikes();

    currentPage = page;

    // Select videos according to tab
    let combinedVideos = [];
    switch (currentTab) {
      case 'uploads':
        combinedVideos = userVideos;
        break;
      case 'favorites':
        combinedVideos = [...defaultVideos, ...userVideos].filter(v => favorites.includes(v.id));
        break;
      case 'extras':
        combinedVideos = []; // Add extras if needed
        break;
      case 'all':
      default:
        combinedVideos = [...defaultVideos, ...userVideos];
        break;
    }

    // Fetch titles
    const videosWithTitles = await fetchTitles(combinedVideos);

    // Filter by search
    const filtered = videosWithTitles.filter(v => v.title.toLowerCase().includes(searchTerm.toLowerCase()));

    const totalVideos = filtered.length;
    const totalPages = Math.ceil(totalVideos / VIDEOS_PER_PAGE);

    if (currentPage > totalPages) currentPage = totalPages || 1;
    if (currentPage < 1) currentPage = 1;

    videosGrid.innerHTML = '';
    if (totalVideos === 0) {
      videosGrid.innerHTML = `<p style="color:#ff3c00; font-weight:bold; grid-column:1/-1; text-align:center;">No videos found.</p>`;
      pagination.innerHTML = '';
      return;
    }

    const start = (currentPage -1) * VIDEOS_PER_PAGE;
    const end = start + VIDEOS_PER_PAGE;
    const toShow = filtered.slice(start, end);

    toShow.forEach(video => {
      const card = document.createElement('div');
      card.className = 'video-card';

      const thumb = document.createElement('div');
      thumb.className = 'video-thumb';
      thumb.innerHTML = `
        <iframe
          src="https://www.youtube.com/embed/${video.id}"
          title="${video.title}"
          allowfullscreen
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          loading="lazy"
        ></iframe>
      `;

      const info = document.createElement('div');
      info.className = 'video-info';

      const title = document.createElement('div');
      title.className = 'video-title';
      title.textContent = video.title;

      const actions = document.createElement('div');
      actions.className = 'video-actions';

      // Like button
      const likeBtn = document.createElement('button');
      const liked = !!likes[video.id];
      likeBtn.textContent = liked ? 'ðŸ‘ Unlike' : 'ðŸ‘ Like';
      likeBtn.className = liked ? 'liked' : '';
      likeBtn.title = liked ? 'Remove your like' : 'Like this video';
      likeBtn.addEventListener('click', () => {
        if (likes[video.id]) {
          delete likes[video.id];
        } else {
          likes[video.id] = 1;
        }
        saveLikes();
        renderVideos(currentPage);
      });

      // Favorite button
      const favBtn = document.createElement('button');
      const isFav = favorites.includes(video.id);
      favBtn.textContent = isFav ? 'â­ Remove Favorite' : 'â­ Add to Favorites';
      favBtn.className = isFav ? 'favorited' : '';
      favBtn.title = isFav ? 'Remove from favorites' : 'Add to favorites';
      favBtn.addEventListener('click', () => {
        if (isFav) {
          favorites = favorites.filter(id => id !== video.id);
        } else {
          favorites.push(video.id);
        }
        saveFavorites();
        renderVideos(currentPage);
      });

      actions.appendChild(likeBtn);
      actions.appendChild(favBtn);

      info.appendChild(title);
      info.appendChild(actions);

      card.appendChild(thumb);
      card.appendChild(info);

      videosGrid.appendChild(card);
    });

    renderPagination(totalPages, currentPage);
  }

  function renderPagination(totalPages, currentPage) {
    pagination.innerHTML = '';
    if (totalPages <= 1) return;

    const prevBtn = document.createElement('button');
    prevBtn.textContent = 'Previous';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => renderVideos(currentPage - 1);
    pagination.appendChild(prevBtn);

    let startPage = Math.max(1, currentPage - 2);
    let endPage = Math.min(totalPages, startPage + 4);
    if (endPage - startPage < 4) {
      startPage = Math.max(1, endPage - 4);
    }
    for (let i = startPage; i <= endPage; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.className = i === currentPage ? 'active' : '';
      btn.onclick = () => renderVideos(i);
      pagination.appendChild(btn);
    }

    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Next';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => renderVideos(currentPage + 1);
    pagination.appendChild(nextBtn);
  }

  // Search handler with debounce
  let debounceTimeout;
  searchInput.addEventListener('input', () => {
    clearTimeout(debounceTimeout);
    debounceTimeout = setTimeout(() => {
      searchTerm = searchInput.value.trim();
      currentPage = 1;
      renderVideos();
    }, 300);
  });

  // Tab buttons handler
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      currentTab = tab.dataset.tab;
      currentPage = 1;
      searchTerm = '';
      searchInput.value = '';
      renderVideos();
    });
  });

  // Upload form handler (adding new YouTube video by URL)
  uploadForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const url = videoUrlInput.value.trim();

    // Extract video ID from URL
    const videoIdMatch = url.match(/v=([\w-]{11})/);
    if (!videoIdMatch) {
      alert('Invalid YouTube URL. Please use the full URL, e.g., https://www.youtube.com/watch?v=VIDEO_ID');
      return;
    }
    const videoId = videoIdMatch[1];

    // Check if video already exists in uploads
    if (userVideos.some(v => v.id === videoId)) {
      alert('This video is already uploaded.');
      videoUrlInput.value = '';
      return;
    }

    // Optionally check if video is valid by fetching title
    const title = await fetchTitle(videoId);
    if (title === 'Unknown Title') {
      alert('Could not find video. Please check the URL.');
      return;
    }

    // Add new video to user uploads
    userVideos.push({ id: videoId, category: 'uploads' });
    saveUserVideos(userVideos);

    alert(`Video added: ${title}`);
    videoUrlInput.value = '';

    // Refresh videos, switch to uploads tab
    currentTab = 'uploads';
    tabs.forEach(t => t.classList.remove('active'));
    document.querySelector('button[data-tab="uploads"]').classList.add('active');
    searchTerm = '';
    searchInput.value = '';
    currentPage = 1;
    renderVideos();
  });

  // Initial render
  renderVideos();
</script>
</body>
</html>
