<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VideoHub</title>
<style>
  body {
    background-color: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
  }
  header {
    background-color: #1f1f1f;
    padding: 15px 20px;
    display: flex;
    align-items: center;
  }
  header h1 {
    margin: 0;
    flex-grow: 1;
  }
  #search {
    padding: 6px 12px;
    border-radius: 4px;
    border: none;
    font-size: 16px;
    background: #333;
    color: #eee;
  }
  #tabs {
    display: flex;
    background: #2a2a2a;
  }
  #tabs button {
    flex-grow: 1;
    padding: 14px 0;
    background: none;
    border: none;
    color: #aaa;
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.2s;
  }
  #tabs button.active {
    background-color: #444;
    color: #fff;
  }
  #videos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 18px;
    padding: 20px;
  }
  .video-card {
    background-color: #222;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 0 8px #000;
    display: flex;
    flex-direction: column;
  }
  .video-card img {
    width: 100%;
    display: block;
  }
  .video-info {
    padding: 12px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  .video-title {
    font-weight: bold;
    font-size: 14px;
    margin-bottom: 8px;
    color: #ddd;
    flex-grow: 1;
  }
  .buttons {
    display: flex;
    gap: 10px;
  }
  button.like-btn, button.fav-btn {
    flex-grow: 1;
    padding: 8px;
    background-color: #333;
    border: none;
    border-radius: 5px;
    color: #ccc;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  button.like-btn.liked {
    background-color: #e74c3c;
    color: white;
  }
  button.fav-btn.favorited {
    background-color: #f1c40f;
    color: black;
  }
  #pagination {
    text-align: center;
    padding: 12px 0 30px 0;
  }
  #pagination button {
    margin: 0 5px;
    background-color: #333;
    border: none;
    padding: 8px 15px;
    color: #ccc;
    font-weight: bold;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  #pagination button.active {
    background-color: #555;
    color: white;
  }

  /* Modal */
  #video-modal {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #video-modal.active {
    display: flex;
  }
  .modal-content {
    background-color: #1c1c1c;
    padding: 20px;
    border-radius: 12px;
    width: 90vw;
    max-width: 900px;
    max-height: 90vh;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
  }
  .modal-header h2 {
    margin: 0;
    font-size: 22px;
    color: #fff;
  }
  .modal-close {
    font-size: 28px;
    background: none;
    border: none;
    color: #ccc;
    cursor: pointer;
    font-weight: bold;
  }
  iframe {
    width: 100%;
    height: 400px;
    border: none;
    border-radius: 8px;
  }
  .modal-buttons {
    margin-top: 12px;
    display: flex;
    gap: 12px;
  }
  .modal-buttons button {
    flex-grow: 1;
    background-color: #333;
    border: none;
    border-radius: 8px;
    padding: 12px 0;
    color: #ccc;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  .modal-buttons button.liked {
    background-color: #e74c3c;
    color: white;
  }
  .modal-buttons button.favorited {
    background-color: #f1c40f;
    color: black;
  }

  /* Comments Section */
  #comments-section {
    margin-top: 22px;
    color: #eee;
  }
  #comments-list {
    max-height: 200px;
    overflow-y: auto;
    background-color: #282828;
    padding: 12px;
    border-radius: 8px;
    font-size: 14px;
  }
  .comment {
    padding: 8px 10px;
    border-bottom: 1px solid #444;
  }
  .comment:last-child {
    border-bottom: none;
  }
  .comment strong {
    color: #f1c40f;
  }
  #comment-input-container {
    margin-top: 14px;
    display: flex;
    gap: 10px;
  }
  #comment-input {
    flex-grow: 1;
    padding: 10px;
    border-radius: 6px;
    border: none;
    background-color: #333;
    color: #eee;
    font-size: 14px;
  }
  #add-comment-btn {
    padding: 10px 20px;
    background-color: #555;
    border: none;
    border-radius: 6px;
    color: #eee;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  #add-comment-btn:hover {
    background-color: #777;
  }
</style>
</head>
<body>

<header>
  <h1>VideoHub</h1>
  <input id="search" type="search" placeholder="Search videos..." aria-label="Search videos" />
</header>

<div id="tabs" role="tablist" aria-label="Video Filters">
  <button class="active" data-tab="all" role="tab" aria-selected="true" tabindex="0">All</button>
  <button data-tab="uploads" role="tab" aria-selected="false" tabindex="-1">Uploads</button>
  <button data-tab="favorites" role="tab" aria-selected="false" tabindex="-1">Favorites</button>
</div>

<main id="videos-grid" aria-live="polite" aria-label="Videos grid"></main>

<div id="pagination" role="navigation" aria-label="Page navigation"></div>

<!-- Video Modal -->
<div id="video-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modal-title">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modal-title">Video Title</h2>
      <button class="modal-close" aria-label="Close modal">&times;</button>
    </div>
    <iframe src="" allow="autoplay; encrypted-media" allowfullscreen title="Video player"></iframe>
    <div class="modal-buttons">
      <button class="like-btn" aria-pressed="false" aria-label="Like video">Like</button>
      <button class="fav-btn" aria-pressed="false" aria-label="Favorite video">Favorite</button>
    </div>

    <section id="comments-section" aria-label="Comments section">
      <div id="comments-list" tabindex="0" aria-live="polite"></div>
      <div id="comment-input-container">
        <input id="comment-input" type="text" placeholder="Write a comment..." aria-label="Write a comment" />
        <button id="add-comment-btn" aria-label="Add comment">Send</button>
      </div>
    </section>
  </div>
</div>

<script>
  // Videos originais com títulos e ids do YouTube (igual no seu site)
  const videos = [
    {id: 'dQw4w9WgXcQ', title: "Rick Astley - Never Gonna Give You Up (Official Music Video)", source: "uploads"},
    {id: 'kJQP7kiw5Fk', title: "Luis Fonsi - Despacito ft. Daddy Yankee", source: "uploads"},
    {id: '9bZkp7q19f0', title: "PSY - GANGNAM STYLE(강남스타일) M/V", source: "others"},
    {id: '3tmd-ClpJxA', title: "Mark Ronson - Uptown Funk ft. Bruno Mars", source: "others"},
    {id: 'JGwWNGJdvx8', title: "Ed Sheeran - Shape of You [Official Video]", source: "uploads"},
    {id: 'RgKAFK5djSk', title: "Wiz Khalifa - See You Again ft. Charlie Puth", source: "others"},
  ];

  // Nomes aleatórios para comentários
  const usernames = [
    "Carlos", "Ana", "Lucas", "Mariana", "Pedro",
    "Fernanda", "João", "Beatriz", "Rafael", "Camila"
  ];

  const videosGrid = document.getElementById('videos-grid');
  const pagination = document.getElementById('pagination');
  const searchInput = document.getElementById('search');
  const tabs = Array.from(document.querySelectorAll('#tabs button'));
  const videoModal = document.getElementById('video-modal');
  const modalTitle = videoModal.querySelector('#modal-title');
  const modalCloseBtn = videoModal.querySelector('.modal-close');
  const modalIframe = videoModal.querySelector('iframe');
  const modalLikeBtn = videoModal.querySelector('.like-btn');
  const modalFavBtn = videoModal.querySelector('.fav-btn');
  const commentsList = document.getElementById('comments-list');
  const commentInput = document.getElementById('comment-input');
  const addCommentBtn = document.getElementById('add-comment-btn');

  let currentTab = "all";
  const VIDEOS_PER_PAGE = 6;
  let currentPage = 1;
  let currentVideoId = null;

  // --- Local Storage Functions ---
  function loadLikes() {
    try {
      return JSON.parse(localStorage.getItem('videoLikes')) || {};
    } catch {
      return {};
    }
  }
  function saveLikes(likes) {
    localStorage.setItem('videoLikes', JSON.stringify(likes));
  }
  function loadFavorites() {
    try {
      return JSON.parse(localStorage.getItem('videoFavorites')) || [];
    } catch {
      return [];
    }
  }
  function saveFavorites(favorites) {
    localStorage.setItem('videoFavorites', JSON.stringify(favorites));
  }
  function loadComments() {
    try {
      return JSON.parse(localStorage.getItem('videoComments')) || {};
    } catch {
      return {};
    }
  }
  function saveComments(comments) {
    localStorage.setItem('videoComments', JSON.stringify(comments));
  }

  // --- Filter videos by tab and search ---
  function filterVideos() {
    let filtered = videos;

    if(currentTab === "uploads") {
      filtered = filtered.filter(v => v.source === "uploads");
    } else if(currentTab === "favorites") {
      const favs = loadFavorites();
      filtered = filtered.filter(v => favs.includes(v.id));
    }

    const searchTerm = searchInput.value.toLowerCase();
    if(searchTerm) {
      filtered = filtered.filter(v => v.title.toLowerCase().includes(searchTerm));
    }

    return filtered;
  }

  // --- Render videos grid ---
  function renderVideos(page = 1) {
    currentPage = page;
    const filtered = filterVideos();
    const totalPages = Math.ceil(filtered.length / VIDEOS_PER_PAGE);

    videosGrid.innerHTML = "";
    pagination.innerHTML = "";

    if(filtered.length === 0) {
      videosGrid.innerHTML = '<p style="grid-column: 1/-1; text-align:center; color:#aaa;">No videos found.</p>';
      return;
    }

    const start = (page - 1) * VIDEOS_PER_PAGE;
    const end = start + VIDEOS_PER_PAGE;
    const pageVideos = filtered.slice(start, end);

    const likes = loadLikes();
    const favorites = loadFavorites();

    pageVideos.forEach(video => {
      const card = document.createElement("div");
      card.className = "video-card";
      card.setAttribute("tabindex", "0");
      card.setAttribute("role", "button");
      card.setAttribute("aria-label", `Open video: ${video.title}`);

      card.addEventListener("click", () => openModal(video.id));
      card.addEventListener("keypress", e => {
        if(e.key === "Enter" || e.key === " ") {
          openModal(video.id);
          e.preventDefault();
        }
      });

      const thumbDiv = document.createElement("div");
      const thumbnailUrl = `https://img.youtube.com/vi/${video.id}/hqdefault.jpg`;
      thumbDiv.className = "video-thumbnail";
      thumbDiv.innerHTML = `<img src="${thumbnailUrl}" alt="Thumbnail of ${video.title}">`;

      const infoDiv = document.createElement("div");
      infoDiv.className = "video-info";

      const titleDiv = document.createElement("div");
      titleDiv.className = "video-title";
      titleDiv.textContent = video.title;

      const btnDiv = document.createElement("div");
      btnDiv.className = "buttons";

      // Like button
      const likeBtn = document.createElement("button");
      likeBtn.className = "like-btn";
      if(likes[video.id]) likeBtn.classList.add("liked");
      likeBtn.textContent = "Like";
      likeBtn.setAttribute("aria-pressed", likes[video.id] ? "true" : "false");
      likeBtn.addEventListener("click", e => {
        e.stopPropagation();
        toggleLike(video.id, likeBtn);
      });

      // Favorite button
      const favBtn = document.createElement("button");
      favBtn.className = "fav-btn";
      if(favorites.includes(video.id)) favBtn.classList.add("favorited");
      favBtn.textContent = "Favorite";
      favBtn.setAttribute("aria-pressed", favorites.includes(video.id) ? "true" : "false");
      favBtn.addEventListener("click", e => {
        e.stopPropagation();
        toggleFavorite(video.id, favBtn);
      });

      btnDiv.appendChild(likeBtn);
      btnDiv.appendChild(favBtn);

      infoDiv.appendChild(titleDiv);
      infoDiv.appendChild(btnDiv);

      card.appendChild(thumbDiv);
      card.appendChild(infoDiv);

      videosGrid.appendChild(card);
    });

    // Pagination buttons
    for(let i = 1; i <= totalPages; i++) {
      const pageBtn = document.createElement("button");
      pageBtn.textContent = i;
      if(i === page) pageBtn.classList.add("active");
      pageBtn.addEventListener("click", () => renderVideos(i));
      pagination.appendChild(pageBtn);
    }
  }

  // --- Toggle like ---
  function toggleLike(videoId, btn) {
    let likes = loadLikes();
    if(likes[videoId]) {
      delete likes[videoId];
      btn.classList.remove("liked");
      btn.setAttribute("aria-pressed", "false");
    } else {
      likes[videoId] = true;
      btn.classList.add("liked");
      btn.setAttribute("aria-pressed", "true");
    }
    saveLikes(likes);

    // Update modal button if same video open
    if(videoId === currentVideoId) {
      updateModalLikeButton();
    }
  }

  // --- Toggle favorite ---
  function toggleFavorite(videoId, btn) {
    let favorites = loadFavorites();
    if(favorites.includes(videoId)) {
      favorites = favorites.filter(id => id !== videoId);
      btn.classList.remove("favorited");
      btn.setAttribute("aria-pressed", "false");
    } else {
      favorites.push(videoId);
      btn.classList.add("favorited");
      btn.setAttribute("aria-pressed", "true");
    }
    saveFavorites(favorites);

    // Update modal button if same video open
    if(videoId === currentVideoId) {
      updateModalFavButton();
    }

    // If current tab is favorites, refresh grid to remove unfavorited videos
    if(currentTab === "favorites") {
      renderVideos(currentPage);
    }
  }

  // --- Open modal with video ---
  function openModal(videoId) {
    currentVideoId = videoId;
    const video = videos.find(v => v.id === videoId);
    if(!video) return;

    modalTitle.textContent = video.title;
    modalIframe.src = `https://www.youtube.com/embed/${video.id}?autoplay=1&rel=0`;

    videoModal.classList.add("active");
    videoModal.setAttribute("aria-hidden", "false");

    updateModalLikeButton();
    updateModalFavButton();

    // Load comments for this video
    renderComments(videoId);

    commentInput.value = "";
    commentInput.focus();
  }

  // --- Close modal ---
  function closeModal() {
    videoModal.classList.remove("active");
    videoModal.setAttribute("aria-hidden", "true");
    modalIframe.src = ""; // stop video playback
    currentVideoId = null;
  }

  modalCloseBtn.addEventListener("click", closeModal);
  videoModal.addEventListener("click", e => {
    if(e.target === videoModal) closeModal();
  });
  window.addEventListener("keydown", e => {
    if(e.key === "Escape" && videoModal.classList.contains("active")) {
      closeModal();
    }
  });

  // --- Update modal like button ---
  function updateModalLikeButton() {
    const likes = loadLikes();
    if(currentVideoId && likes[currentVideoId]) {
      modalLikeBtn.classList.add("liked");
      modalLikeBtn.setAttribute("aria-pressed", "true");
    } else {
      modalLikeBtn.classList.remove("liked");
      modalLikeBtn.setAttribute("aria-pressed", "false");
    }
  }

  // --- Update modal favorite button ---
  function updateModalFavButton() {
    const favorites = loadFavorites();
    if(currentVideoId && favorites.includes(currentVideoId)) {
      modalFavBtn.classList.add("favorited");
      modalFavBtn.setAttribute("aria-pressed", "true");
    } else {
      modalFavBtn.classList.remove("favorited");
      modalFavBtn.setAttribute("aria-pressed", "false");
    }
  }

  modalLikeBtn.addEventListener("click", () => {
    if(currentVideoId) {
      let likes = loadLikes();
      if(likes[currentVideoId]) {
        delete likes[currentVideoId];
      } else {
        likes[currentVideoId] = true;
      }
      saveLikes(likes);
      updateModalLikeButton();
      renderVideos(currentPage);
    }
  });

  modalFavBtn.addEventListener("click", () => {
    if(currentVideoId) {
      let favorites = loadFavorites();
      if(favorites.includes(currentVideoId)) {
        favorites = favorites.filter(id => id !== currentVideoId);
      } else {
        favorites.push(currentVideoId);
      }
      saveFavorites(favorites);
      updateModalFavButton();
      renderVideos(currentPage);
    }
  });

  // --- Comments ---

  function renderComments(videoId) {
    const allComments = loadComments();
    const videoComments = allComments[videoId] || [];
    commentsList.innerHTML = "";

    if(videoComments.length === 0) {
      commentsList.innerHTML = "<p style='color:#aaa;'>No comments yet.</p>";
      return;
    }

    videoComments.forEach(c => {
      const div = document.createElement("div");
      div.className = "comment";
      div.innerHTML = `<strong>${c.user}:</strong> ${c.text}`;
      commentsList.appendChild(div);
    });
  }

  addCommentBtn.addEventListener("click", () => {
    const text = commentInput.value.trim();
    if(!text || !currentVideoId) return;

    // Add comment with random user
    const user = usernames[Math.floor(Math.random() * usernames.length)];

    const allComments = loadComments();
    if(!allComments[currentVideoId]) allComments[currentVideoId] = [];
    allComments[currentVideoId].push({user, text});
    saveComments(allComments);

    commentInput.value = "";
    renderComments(currentVideoId);
  });

  // Add comment on Enter key press
  commentInput.addEventListener("keypress", e => {
    if(e.key === "Enter") {
      e.preventDefault();
      addCommentBtn.click();
    }
  });

  // --- Tab switching ---
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => {
        t.classList.remove("active");
        t.setAttribute("aria-selected", "false");
        t.setAttribute("tabindex", "-1");
      });
      tab.classList.add("active");
      tab.setAttribute("aria-selected", "true");
      tab.setAttribute("tabindex", "0");

      currentTab = tab.getAttribute("data-tab");
      renderVideos(1);
    });
  });

  // --- Search ---
  searchInput.addEventListener("input", () => renderVideos(1));

  // Initial render
  renderVideos(1);

</script>

</body>
</html>
