<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VideoHub - Watch & Earn VVC</title>
<style>
  /* Reset b√°sico */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #eee;
    cursor: url('https://cdn-icons-png.flaticon.com/512/616/616408.png'), auto; /* espada cursor */
  }
  header {
    background: #1f1f1f;
    padding: 15px 20px;
    font-size: 1.5rem;
    font-weight: bold;
    text-align: center;
    border-bottom: 2px solid #ff3c00;
  }
  .container {
    display: flex;
    height: calc(100vh - 60px);
  }
  nav.sidebar {
    width: 220px;
    background: #222;
    display: flex;
    flex-direction: column;
    padding: 20px;
  }
  nav.sidebar h2 {
    font-size: 1.3rem;
    margin-bottom: 10px;
    color: #ff3c00;
  }
  nav.sidebar input[type="text"],
  nav.sidebar input[type="url"] {
    padding: 8px;
    border-radius: 6px;
    border: none;
    margin-bottom: 20px;
    font-size: 1rem;
  }
  nav.sidebar button {
    margin-top: 10px;
    padding: 10px;
    background: #ff3c00;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  nav.sidebar button:hover {
    background: #e63600;
  }
  main.content {
    flex-grow: 1;
    padding: 20px;
    overflow-y: auto;
    background: #181818;
  }
  .coin-counter {
    font-size: 1.2rem;
    font-weight: 600;
    color: #ff9a00;
    margin-bottom: 20px;
  }
  .videos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(350px,1fr));
    gap: 18px;
  }
  .video-card {
    background: #272727;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 0 8px #ff3c00cc;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .video-title {
    margin: 0 0 10px 0;
    font-size: 1.1rem;
    text-align: center;
    color: #ff7a00;
  }
  iframe {
    border-radius: 8px;
  }
  button.btn-watch-enabled {
    margin-top: 12px;
    padding: 10px 14px;
    font-weight: bold;
    background-color: #ff3c00;
    border: none;
    border-radius: 6px;
    color: #fff;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button.btn-watch-enabled:hover {
    background-color: #e63600;
  }
  button.btn-watch-disabled,
  button.btn-watch-done {
    margin-top: 12px;
    padding: 10px 14px;
    font-weight: bold;
    background-color: #555;
    border: none;
    border-radius: 6px;
    color: #ccc;
    cursor: not-allowed;
  }
  /* Scrollbar styling */
  main.content::-webkit-scrollbar {
    width: 10px;
  }
  main.content::-webkit-scrollbar-track {
    background: #222;
  }
  main.content::-webkit-scrollbar-thumb {
    background-color: #ff3c00;
    border-radius: 10px;
  }
  /* Responsive */
  @media (max-width: 768px) {
    .container {
      flex-direction: column;
    }
    nav.sidebar {
      width: 100%;
      flex-direction: row;
      overflow-x: auto;
      padding: 10px;
    }
    nav.sidebar > * {
      margin-right: 20px;
    }
    main.content {
      height: auto;
    }
  }
</style>
</head>
<body>
<header>VideoHub üé•</header>
<div class="container">
  <nav class="sidebar">
    <h2>Search Videos üîç</h2>
    <input type="text" id="searchInput" placeholder="Search by title..." />
    
    <h2>Upload YouTube Video ‚¨ÜÔ∏è</h2>
    <label for="videoURL">YouTube URL:</label>
    <input type="url" id="videoURL" placeholder="https://www.youtube.com/watch?v=..." />
    <button id="uploadBtn">Upload Video</button>

    <div class="coin-counter" id="coinCounter">VVC Balance: 0</div>
  </nav>
  <main class="content">
    <div class="videos-grid" id="videosGrid"></div>
  </main>
</div>

<script>
  // ======== Variables ========
  let vvc = 0; // Virtual VideoHub Coins
  const videosGrid = document.getElementById('videosGrid');
  const coinCounter = document.getElementById('coinCounter');
  const searchInput = document.getElementById('searchInput');
  const videoURLInput = document.getElementById('videoURL');
  const uploadBtn = document.getElementById('uploadBtn');

  // Predefined English videos (verified)
  const defaultVideos = [
    { id: "dQw4w9WgXcQ", title: "Rick Astley - Never Gonna Give You Up" },
    { id: "3Wod2AX0PR4", title: "Minecraft Bedwars - Epic Win!" },
    { id: "LsoLEjrDogU", title: "Minecraft Bedwars - Best Defense Strategy" },
    { id: "0jGfR2aTkNc", title: "Minecraft Bedwars - Clutch Gameplay" },
    { id: "bRjE9jxTEQY", title: "Minecraft Bedwars - Insane PvP Battle" }
  ];

  // Load from localStorage
  function loadState() {
    const storedVVC = parseInt(localStorage.getItem("vvc"), 10);
    if (!isNaN(storedVVC)) vvc = storedVVC;
  }
  function saveState() {
    localStorage.setItem("vvc", vvc);
  }
  function getWatchedVideos() {
    return JSON.parse(localStorage.getItem("watchedVideos") || "{}");
  }
  function setVideoWatched(videoId) {
    const watched = getWatchedVideos();
    watched[videoId] = true;
    localStorage.setItem("watchedVideos", JSON.stringify(watched));
  }
  function hasWatched(videoId) {
    const watched = getWatchedVideos();
    return !!watched[videoId];
  }

  // Validate YouTube URL (simplified)
  function extractYouTubeID(url) {
    const regex = /(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]{11})/;
    const match = url.match(regex);
    return match ? match[1] : null;
  }

  // Render coins
  function renderCoinCount() {
    coinCounter.textContent = `VVC Balance: ${vvc}`;
  }

  // YouTube API players map
  const players = new Map();

  // Create video card
  function createVideoCard(video) {
    const card = document.createElement('div');
    card.className = 'video-card';

    const title = document.createElement('h3');
    title.textContent = video.title;
    title.className = 'video-title';
    card.appendChild(title);

    // Create iframe with enablejsapi=1 to allow JS API control
    const iframe = document.createElement('iframe');
    iframe.width = "320";
    iframe.height = "180";
    iframe.src = `https://www.youtube.com/embed/${video.id}?enablejsapi=1&origin=${location.origin}`;
    iframe.frameBorder = "0";
    iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
    iframe.allowFullscreen = true;
    card.appendChild(iframe);

    const btnWatch = document.createElement('button');
    btnWatch.textContent = "Watch & Earn VVC (+5)";
    btnWatch.disabled = true;
    btnWatch.className = "btn-watch-disabled";
    card.appendChild(btnWatch);

    if (hasWatched(video.id)) {
      btnWatch.textContent = "Already Earned";
      btnWatch.disabled = true;
      btnWatch.className = "btn-watch-done";
    }

    // Player state handler
    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        if (!hasWatched(video.id)) {
          btnWatch.disabled = false;
          btnWatch.className = "btn-watch-enabled";
        }
      }
    }

    // Create player and store it
    function createPlayer() {
      const player = new YT.Player(iframe, {
        events: {
          'onStateChange': onPlayerStateChange
        }
      });
      players.set(video.id, player);
    }

    if (typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
      // Load API script once
      if (!window.youTubeApiScriptAdded) {
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.head.appendChild(tag);
        window.youTubeApiScriptAdded = true;
      }

      // Register callback
      const oldCallback = window.onYouTubeIframeAPIReady;
      window.onYouTubeIframeAPIReady = function() {
        if (oldCallback) oldCallback();
        createPlayer();
      };
    } else {
      createPlayer();
    }

    btnWatch.addEventListener('click', () => {
      if (!hasWatched(video.id)) {
        vvc += 5;
        setVideoWatched(video.id);
        saveState();
        renderCoinCount();
        btnWatch.textContent = "Already Earned";
        btnWatch.disabled = true;
        btnWatch.className = "btn-watch-done";
        alert("You've earned 5 VVC!");
      }
    });

    return card;
  }

  // Render videos list (with optional search filter)
  function renderVideos(filter = '') {
    videosGrid.innerHTML = '';
    const lowerFilter = filter.toLowerCase();
    const videosToShow = videos.filter(v => v.title.toLowerCase().includes(lowerFilter));
    if (videosToShow.length === 0) {
      videosGrid.innerHTML = '<p>No videos found.</p>';
      return;
    }
    videosToShow.forEach(video => {
      const card = createVideoCard(video);
      videosGrid.appendChild(card);
    });
  }

  // Initialize videos array with default videos + any uploaded saved videos
  let videos = [];
  function loadVideos() {
    // load user uploaded videos from localStorage
    const userVideos = JSON.parse(localStorage.getItem("userVideos") || "[]");
    videos = [...defaultVideos, ...userVideos];
  }

  // Add new video to userVideos and refresh
  async function addUserVideo(video) {
    // Check if video exists on YouTube via oEmbed API (no key needed)
    try {
      const res = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${video.id}&format=json`);
      if (!res.ok) {
        alert("Video not found or is unavailable.");
        return;
      }
    } catch (e) {
      alert("Error verifying the video.");
      return;
    }

    // Prevent duplicates
    if (videos.some(v => v.id === video.id)) {
      alert("This video is already in the list.");
      return;
    }
    const userVideos = JSON.parse(localStorage.getItem("userVideos") || "[]");
    userVideos.push(video);
    localStorage.setItem("userVideos", JSON.stringify(userVideos));
    loadVideos();
    renderVideos(searchInput.value);
  }

  // Event listeners
  uploadBtn.addEventListener('click', () => {
    const url = videoURLInput.value.trim();
    const id = extractYouTubeID(url);
    if (!id) {
      alert("Please enter a valid YouTube video URL!");
      return;
    }
    addUserVideo({ id, title: "User Uploaded Video" });
    videoURLInput.value = '';
  });

  searchInput.addEventListener('input', () => {
    renderVideos(searchInput.value);
  });

  // Initial load
  loadState();
  loadVideos();
  renderCoinCount();
  renderVideos();

</script>
</body>
</html>
