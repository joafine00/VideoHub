<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VideoHub</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f9f9f9;
  }
  header {
    background: #222;
    color: white;
    padding: 1rem;
    text-align: center;
    font-size: 2rem;
    font-weight: bold;
  }
  main {
    display: flex;
    max-width: 1000px;
    margin: 20px auto;
    gap: 20px;
  }
  #video-list {
    flex: 1 1 300px;
    max-height: 80vh;
    overflow-y: auto;
    border-right: 1px solid #ccc;
    background: white;
    border-radius: 6px;
    padding: 10px;
  }
  #video-list h2 {
    text-align: center;
    margin-top: 0;
  }
  .video-item {
    cursor: pointer;
    border-bottom: 1px solid #ddd;
    padding: 10px 5px;
    display: flex;
    gap: 10px;
    align-items: center;
    transition: background-color 0.2s;
  }
  .video-item:hover {
    background-color: #eef6ff;
  }
  .video-item.selected {
    background-color: #c8defd;
  }
  .video-thumb {
    width: 120px;
    height: 67px;
    object-fit: cover;
    border-radius: 4px;
  }
  #player-section {
    flex: 2 1 600px;
    display: flex;
    flex-direction: column;
    background: white;
    border-radius: 6px;
    padding: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  #video-player {
    width: 100%;
    height: 360px;
    background: black;
    border-radius: 6px;
    overflow: hidden;
  }
  iframe, video {
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 6px;
  }
  #video-title {
    margin: 10px 0 5px 0;
    font-weight: bold;
    font-size: 1.2rem;
  }
  #video-options {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
  }
  #video-options button {
    background: #007bff;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    user-select: none;
    transition: background-color 0.3s;
  }
  #video-options button[aria-pressed="true"] {
    background: #004a99;
  }
  #video-options button:hover {
    background-color: #0056cc;
  }
  #comments-section {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  #comments-section h3 {
    margin-top: 0;
    margin-bottom: 10px;
  }
  #comments-list {
    list-style: none;
    padding-left: 0;
    max-height: 150px;
    overflow-y: auto;
    border-top: 1px solid #ccc;
    margin-bottom: 10px;
  }
  #comments-list li {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
    font-size: 14px;
  }
  #comment-input {
    width: 100%;
    min-height: 60px;
    font-size: 14px;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    resize: vertical;
    margin-bottom: 10px;
  }
  #comment-submit-btn {
    align-self: flex-end;
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 20px;
    font-size: 14px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
  }
  #comment-submit-btn:disabled {
    background: #aaa;
    cursor: not-allowed;
  }
  @media (max-width: 720px) {
    main {
      flex-direction: column;
      margin: 10px;
    }
    #video-list {
      max-height: 200px;
      border-right: none;
      border-bottom: 1px solid #ccc;
    }
    #player-section {
      margin-top: 20px;
    }
  }
</style>
</head>
<body>

<header>VideoHub</header>

<main>
  <section id="video-list" aria-label="Video list">
    <h2>Videos</h2>
    <!-- Video items injected here -->
  </section>

  <section id="player-section" aria-label="Video player and details">
    <div id="video-player">
      <!-- iframe or video tag inserted here -->
    </div>
    <div id="video-title"></div>
    <div id="video-options">
      <button id="like-btn" aria-pressed="false" title="Like">üëç Like (<span id="like-count">0</span>)</button>
      <button id="favorite-btn" aria-pressed="false" title="Add to favorites">‚≠ê Favorite</button>
      <button id="share-btn" title="Share this video">üîó Share</button>
    </div>
    <section id="comments-section" aria-label="Comments section">
      <h3>Comments</h3>
      <ul id="comments-list">
        <!-- comments here -->
      </ul>
      <textarea id="comment-input" placeholder="Add a comment..."></textarea>
      <button id="comment-submit-btn" disabled>Add Comment</button>
    </section>
  </section>
</main>

<script>
  // Sample videos data
  const videos = [
    {
      id: "vid1",
      title: "Amazing Nature",
      thumb: "https://picsum.photos/id/1018/160/90",
      url: "https://www.youtube.com/embed/6lt2JfJdGSY"
    },
    {
      id: "vid2",
      title: "City Timelapse",
      thumb: "https://picsum.photos/id/1015/160/90",
      url: "https://www.youtube.com/embed/hY7m5jjJ9mM"
    },
    {
      id: "vid3",
      title: "Relaxing Beach",
      thumb: "https://picsum.photos/id/1011/160/90",
      url: "https://www.youtube.com/embed/aqz-KE-bpKQ"
    }
  ];

  // Get references
  const videoListEl = document.getElementById('video-list');
  const playerEl = document.getElementById('video-player');
  const videoTitleEl = document.getElementById('video-title');
  const likeBtn = document.getElementById('like-btn');
  const favoriteBtn = document.getElementById('favorite-btn');
  const shareBtn = document.getElementById('share-btn');
  const likeCountEl = document.getElementById('like-count');
  const commentsListEl = document.getElementById('comments-list');
  const commentInput = document.getElementById('comment-input');
  const commentSubmitBtn = document.getElementById('comment-submit-btn');

  let currentVideoId = null;

  // Helpers for localStorage keys
  function lsKey(type, videoId) {
    return `videoHub_${type}_${videoId}`;
  }

  // Load state from localStorage or init
  function getLikes(videoId) {
    return parseInt(localStorage.getItem(lsKey('likes', videoId))) || 0;
  }
  function setLikes(videoId, count) {
    localStorage.setItem(lsKey('likes', videoId), count);
  }
  function getFavorites() {
    try {
      return JSON.parse(localStorage.getItem('videoHub_favorites')) || [];
    } catch {
      return [];
    }
  }
  function setFavorites(favs) {
    localStorage.setItem('videoHub_favorites', JSON.stringify(favs));
  }
  function getComments(videoId) {
    try {
      return JSON.parse(localStorage.getItem(lsKey('comments', videoId))) || [];
    } catch {
      return [];
    }
  }
  function setComments(videoId, comments) {
    localStorage.setItem(lsKey('comments', videoId), JSON.stringify(comments));
  }

  // Render video list
  function renderVideoList() {
    videoListEl.innerHTML = '<h2>Videos</h2>';
    const favs = getFavorites();

    videos.forEach(video => {
      const item = document.createElement('div');
      item.className = 'video-item';
      if(video.id === currentVideoId) item.classList.add('selected');
      item.tabIndex = 0;
      item.setAttribute('role', 'button');
      item.setAttribute('aria-pressed', video.id === currentVideoId ? 'true' : 'false');
      item.innerHTML = `
        <img class="video-thumb" src="${video.thumb}" alt="Thumbnail for ${video.title}" />
        <span>${video.title}</span>
        ${favs.includes(video.id) ? ' ‚≠ê' : ''}
      `;
      item.addEventListener('click', () => {
        loadVideo(video.id);
      });
      item.addEventListener('keydown', e => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          loadVideo(video.id);
        }
      });
      videoListEl.appendChild(item);
    });
  }

  // Load a video by ID
  function loadVideo(videoId) {
    const video = videos.find(v => v.id === videoId);
    if(!video) return;

    currentVideoId = videoId;

    // Update selected class on video list
    document.querySelectorAll('.video-item').forEach(item => {
      item.classList.toggle('selected', item.querySelector('span').textContent === video.title);
      item.setAttribute('aria-pressed', item.classList.contains('selected') ? 'true' : 'false');
    });

    // Update player
    playerEl.innerHTML = `<iframe src="${video.url}" allowfullscreen title="${video.title}"></iframe>`;
    videoTitleEl.textContent = video.title;

    // Update like count and button state
    const likes = getLikes(videoId);
    likeCountEl.textContent = likes;
    // Like button is toggle? Here, just count, no toggle state

    // Update favorite button state
    const favs = getFavorites();
    const isFav = favs.includes(videoId);
    favoriteBtn.setAttribute('aria-pressed', isFav ? 'true' : 'false');

    // Load comments
    renderComments();

    // Reset comment input and button
    commentInput.value = '';
    commentSubmitBtn.disabled = true;

    // Update URL without reloading
    if(history.pushState) {
      const url = new URL(window.location);
      url.searchParams.set('video', videoId);
      history.pushState(null, '', url);
    }
  }

  // Like button handler
  likeBtn.addEventListener('click', () => {
    if(!currentVideoId) return;
    let likes = getLikes(currentVideoId);
    likes++;
    setLikes(currentVideoId, likes);
    likeCountEl.textContent = likes;
  });

  // Favorite button handler
  favoriteBtn.addEventListener('click', () => {
    if(!currentVideoId) return;
    let favs = getFavorites();
    if(favs.includes(currentVideoId)) {
      // remove
      favs = favs.filter(id => id !== currentVideoId);
      favoriteBtn.setAttribute('aria-pressed', 'false');
    } else {
      favs.push(currentVideoId);
      favoriteBtn.setAttribute('aria-pressed', 'true');
    }
    setFavorites(favs);
    renderVideoList();
  });

  // Share button handler - copies URL to clipboard
  shareBtn.addEventListener('click', () => {
    if(!currentVideoId) return;
    const url = new URL(window.location);
    url.searchParams.set('video', currentVideoId);
    navigator.clipboard.writeText(url.toString()).then(() => {
      alert('Video link copied to clipboard!');
    }).catch(() => {
      alert('Failed to copy. Please copy the URL manually: ' + url.toString());
    });
  });

  // Comments section handlers
  commentInput.addEventListener('input', () => {
    commentSubmitBtn.disabled = commentInput.value.trim() === '';
  });

  commentSubmitBtn.addEventListener('click', () => {
    if(!currentVideoId) return;
    const text = commentInput.value.trim();
    if(text === '') return;

    const comments = getComments(currentVideoId);
    comments.push({
      text,
      timestamp: Date.now()
    });
    setComments(currentVideoId, comments);
    commentInput.value = '';
    commentSubmitBtn.disabled = true;
    renderComments();
  });

  // Render comments list for current video
  function renderComments() {
    const comments = getComments(currentVideoId);
    if(comments.length === 0) {
      commentsListEl.innerHTML = '<li>No comments yet. Be the first!</li>';
      return;
    }
    commentsListEl.innerHTML = '';
    comments.forEach(comment => {
      const li = document.createElement('li');
      const date = new Date(comment.timestamp);
      li.textContent = `${comment.text} (${date.toLocaleString()})`;
      commentsListEl.appendChild(li);
    });
  }

  // On page load, check URL param ?video=
  function getVideoFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('video');
  }

  // Init
  function init() {
    renderVideoList();
    let videoToLoad = getVideoFromURL();
    if(!videoToLoad || !videos.some(v => v.id === videoToLoad)) {
      videoToLoad = videos[0].id; // default first video
    }
    loadVideo(videoToLoad);
  }

  init();

  // Handle browser back/forward navigation to load correct video
  window.addEventListener('popstate', () => {
    const videoToLoad = getVideoFromURL();
    if(videoToLoad && videos.some(v => v.id === videoToLoad)) {
      loadVideo(videoToLoad);
    }
  });
</script>

</body>
</html>
